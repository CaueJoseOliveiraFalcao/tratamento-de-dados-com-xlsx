<!DOCTYPE html>
<html>
  <head>
    <title>Conversão de Excel para JSON</title>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
  </head>
  <body>
    <input type="file" id="file-input" />
    <div id="output"></div>

    <script>
      document.getElementById('file-input').addEventListener('change', handleFileSelect);

      function downloadXlsxArrayAsText(ArrayListOfXlsx, XlsxName) {
        var XlsxText = ArrayListOfXlsx.join('\n');
        var DownloadButton = document.createElement('a');
        DownloadButton.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(XlsxText), 'download', XlsxName);
        DownloadButton.style.display = 'none';
        document.body.appendChild(DownloadButton);
        DownloadButton.click();
        document.body.removeChild(DownloadButton);
      }

      function handleFileSelect(event) {
        UserFileSelect = event.target.files[0];
        var reader = new FileReader();
        var worksheets = {};

        reader.onload = function (e) {
          console.log(e.target.result);
          var ConvertedXlsx = new Uint8Array(e.target.result);
          var XlsxEnd = XLSX.read(ConvertedXlsx, { type: 'array' });

          XlsxEnd.SheetNames.forEach(function (eachXlsx) {
            var worksheet = XlsxEnd.Sheets[eachXlsx];
            worksheets[eachXlsx] = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
          });

          displayOutput(worksheets);

          for (var sheetName in worksheets) {
            console.log('----' + sheetName + '-----');
            var sheetData = worksheets[sheetName];
            let nameCount = {};
            let previosName = null;
            let namesRepeted = [];
            for (var i = 0; i < sheetData.length; i++) {
              if (sheetData[i][5]) {
                const XlsxUserName = sheetData[i][5];
                const WrittenTapiri = XlsxUserName.indexOf('TAPIRI');
                const WrittenCamarote = XlsxUserName.indexOf('CAMAROTE');
                if (previosName && XlsxUserName === previosName && WrittenTapiri && WrittenCamarote === -1) {
                  const nomes =
                    'NOME : ' + XlsxUserName +
                    '           ///DATA : ' + sheetData[i][8] +
                    '           ///LOCAL : ' + sheetData[i][9] +
                    '           ///ACESSO : ' + sheetData[i][11];
                  namesRepeted.push(XlsxUserName);
                  console.log(XlsxUserName);
                }

                previosName = XlsxUserName;
              }
            }
            //downloadXlsxArrayAsText(nameRepeted , 'SERVIÇO 29-01')
          }
        };

        reader.readAsArrayBuffer(UserFileSelect);
      }

      function displayOutput(worksheets) {
        var outputDiv = document.getElementById('output');
        outputDiv.innerHTML = '';

        for (var sheetName in worksheets) {
          var sheetData = worksheets[sheetName];

          var table = document.createElement('table');
          var headerRow = document.createElement('tr');
          for (var headerCell of sheetData[0]) {
            var th = document.createElement('th');
            th.textContent = headerCell;
            headerRow.appendChild(th);
          }
          table.appendChild(headerRow);

          for (var i = 1; i < sheetData.length; i++) {
            var rowData = sheetData[i];
            var row = document.createElement('tr');
            for (var cellData of rowData) {
              var td = document.createElement('td');
              td.textContent = cellData;
              row.appendChild(td);
            }
            table.appendChild(row);
          }

          outputDiv.appendChild(document.createElement('h2')).textContent = sheetName;
          outputDiv.appendChild(table);
        }
      }
    </script>
  </body>
</html>
